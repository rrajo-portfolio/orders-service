server:
  port: 8084
  servlet:
    context-path: /api

spring:
  application:
    name: orders-service
  datasource:
    url: jdbc:mysql://localhost:3309/ordersdb?useUnicode=true&characterEncoding=UTF-8&connectionCollation=utf8mb4_unicode_ci&serverTimezone=UTC&allowPublicKeyRetrieval=true&useSSL=false
    username: orders_user
    password: orders_pass
    hikari:
      connection-init-sql: SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:rabbit}
    password: ${RABBITMQ_PASS:rabbit}
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    baseline-on-migrate: true
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:7080/auth/realms/portfolio/protocol/openid-connect/certs
  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer

services:
  catalog:
    base-url: http://catalog-service:8081/api
  users:
    base-url: http://users-service:8082/api

notifications:
  orders:
    to: talent@portfolio.local

orders:
  notification:
    exchange: order.events.exchange
    routing-key-pattern: orders.notification.*
    enabled: ${ORDERS_NOTIFICATION_ENABLED:true}
  kafka:
    topic: ${ORDERS_KAFKA_TOPIC:orders-checkout-events}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  metrics:
    tags:
      application: ${spring.application.name}
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: http://zipkin:9411/api/v2/spans

resilience4j:
  circuitbreaker:
    instances:
      catalog:
        registerHealthIndicator: true
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        slidingWindowType: COUNT_BASED
        minimumNumberOfCalls: 5
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
      users:
        registerHealthIndicator: true
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        slidingWindowType: COUNT_BASED
        minimumNumberOfCalls: 5
        waitDurationInOpenState: 5s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10

logging:
  level:
    com.portfolio.orders: DEBUG

security:
  oauth2:
    expected-issuer: http://localhost:7080/auth/realms/portfolio
service-account:
  token-uri: http://keycloak:8080/auth/realms/portfolio/protocol/openid-connect/token
  client-id: portfolio-api
  client-secret: portfolio-api-secret

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    display-request-duration: true
  api-docs:
    path: /v3/api-docs
